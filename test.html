<html>
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
</head>
<body>
<a-scene>
    <a-text
            value="Grodzisko"
            look-at="[gps-camera]"
            scale="10 10 10"
            position="0 10 0"
            gps-entity-place="latitude: 50.061942; longitude: 19.903034;">
    </a-text>
    <a-text
            value=""
            look-at="[gps-camera]"
            scale="3 3 3"
            gps-entity-place="latitude: 50.061942; longitude: 19.903034;">
        <!-- Główny wał - podkowa -->
        <a-entity id="main-rampart"></a-entity>

        <!-- Wał II - pierwszy dodatkowy łuk -->
        <a-entity id="secondary-rampart"></a-entity>

        <!-- Wał III - drugi dodatkowy łuk -->
        <a-entity id="tertiary-rampart"></a-entity>
    </a-text>

    <script>
        function createRampart(entityId, segments, radius, offsetY, height, color) {
            const rampart = document.querySelector(entityId);
            for (let i = 0; i < segments; i++) {
                const angle = (i / segments) * Math.PI; // półokrąg (podkowa)
                const x = radius * Math.cos(angle);
                const z = radius * Math.sin(angle);
                const rotation = (angle * 180) / Math.PI;

                const box = document.createElement('a-box');
                box.setAttribute('position', `${x} ${offsetY} ${z}`);
                box.setAttribute('rotation', `0 ${-rotation} 0`);
                box.setAttribute('width', 0.4);
                box.setAttribute('height', height);
                box.setAttribute('depth', 2);
                box.setAttribute('color', color);
                box.setAttribute('opacity', 1);
                box.setAttribute('transparent', true);

                rampart.appendChild(box);
            }
        }

        // Główny wał - podkowa, wyższy
        createRampart('#main-rampart', 25, 20, 0, 1.5, '#E4080A');

        // Wał II - pierwszy łuk od północy, średnia wysokość
        createRampart('#secondary-rampart', 30, 25, 0, 1, '#F6C709');

        // Wał III - drugi łuk od północy, niższy
        createRampart('#tertiary-rampart', 40, 30, 0, 0.5, '#9EB717');

        // Dynamiczne sterowanie opacity
        AFRAME.registerComponent('dynamic-opacity', {
            init: function () {
                const cameraEl = document.querySelector('[camera]');
                const scene = this.el.sceneEl;
                const boxes = scene.querySelectorAll('a-box');

                this.tick = () => {
                    const cameraPosition = new THREE.Vector3();
                    cameraEl.object3D.getWorldPosition(cameraPosition);

                    boxes.forEach(box => {
                        const boxPosition = new THREE.Vector3();
                        box.object3D.getWorldPosition(boxPosition);

                        const distance = cameraPosition.distanceTo(boxPosition);

                        // Ustawienie opacity w zależności od odległości
                        const opacity = Math.max(0, 1 - distance / 100); // np. 100 jednostek to maksymalna odległość
                        box.setAttribute('opacity', opacity);
                    });
                };
            }
        });

        // Przypisanie komponentu do sceny
        document.querySelector('a-scene').setAttribute('dynamic-opacity', '');

    </script>

    <a-camera position="0 1.6 0"></a-camera>
    <a-sky color="#BCECEC"></a-sky>
</a-scene>
</body>
</html>

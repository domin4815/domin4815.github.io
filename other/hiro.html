<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
<a-scene embedded arjs>
    <!-- Marker definition using 'hiro' -->
    <a-marker preset="hiro" id="marker">
        <!-- 3D object (box) displayed to the left of the marker -->
        <a-box position="-0.5 0.5 0" material="color: red;" id="box"></a-box>
    </a-marker>

    <!-- Camera element to render the AR scene -->
    <a-entity camera></a-entity>
</a-scene>

<script>
      // Get the box element
      const box = document.querySelector("#box");
      const marker = document.querySelector("#marker");

      // Flag to check if the marker is visible
      let markerVisible = true;

      // Store the previous position of the box
      let lastPosition = { x: -0.5, y: 0.5, z: 0 };
      let lastRotation = { alpha: 0, beta: 0, gamma: 0 };

      // Handle device orientation (gyroscope data)
      window.addEventListener("deviceorientation", function (event) {
        if (!markerVisible) {
          // If marker is not visible, update position based on device orientation
          const alpha = event.alpha;  // rotation around Z axis
          const beta = event.beta;    // rotation around X axis
          const gamma = event.gamma;  // rotation around Y axis

          // Use simple math to estimate new position based on orientation data
          // (here we're simply updating the box position for demonstration purposes)
          box.setAttribute("position", {
            x: lastPosition.x + (alpha / 100),
            y: lastPosition.y + (beta / 100),
            z: lastPosition.z + (gamma / 100),
          });

          // Optionally update rotation based on orientation
          box.setAttribute("rotation", {
            x: lastRotation.alpha,
            y: lastRotation.beta,
            z: lastRotation.gamma,
          });
        }
      });

      // Listen to the marker visibility
      marker.addEventListener("markerLost", function () {
        markerVisible = false;
        console.log("Marker lost! Estimating position using gyroscope...");
      });

      marker.addEventListener("markerFound", function () {
        markerVisible = true;
        console.log("Marker found! Using marker-based position...");

        // When the marker is found, we save its position and rotation
        const position = box.getAttribute("position");
        const rotation = box.getAttribute("rotation");

        lastPosition = { x: position.x, y: position.y, z: position.z };
        lastRotation = { alpha: rotation.x, beta: rotation.y, gamma: rotation.z };
      });
    </script>
</body>
</html>
